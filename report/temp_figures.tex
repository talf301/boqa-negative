\begin{tikzpicture}[scale=0.15]
    \draw (39.9,-54.6) node[disease] (A) {sickle cell \\ anaemia};
    \draw (64.2,-47.9) node[phenotype] (B) {retinopathy};
    \draw (71.4,-34.6) node[phenotype] (C) {abnormality \\ of the retina};
    \draw (66.5,-15.4) node[phenotype] (D) {abnormality \\ of the eye};
    \draw (48.4,-3.5)  node[phenotype] (E) {phenotypic \\ abnormality};
    \draw (54.4,-40.5) node[phenotype] (F) {cholestatis};
    \draw (54.4,-27)   node[phenotype] (G) {abnormality \\ of the liver};
    \draw (42.9,-16.7) node[phenotype] (H) {abnormality of \\ the biliary system};
    \draw (31.6,-37.9) node[phenotype] (I) {cholelithiasis};
    \draw (32.3,-28.7) node[phenotype] (J) {abnormality of \\ the gall bladder};
    \draw (20.6,-46.4) node[phenotype] (K) {hemolytic anaemia};
    \draw (11.8,-30.9) node[phenotype] (L) {abnormality of \\ bone marrow \\ cell morphology};
    \draw (16.8,-15.4) node[phenotype] (M) {abnormality of \\ blood-forming tissues};
    \draw (28,-5.5)    node[phenotype] (N) {abnormality of \\ cells of the \\ erythroid lineage};
    \edge {A} {B};
    \edge {A} {F};
    \edge {A} {I};
    \edge {A} {K};
    \edge {B} {C};
    \edge {C} {D};
    \edge {D} {E};
    \edge {F} {G};
    \edge {G} {H};
    \edge {I} {J};
    \edge {J} {H};
    \edge {K} {L};
    \edge {L} {M};
    \edge {M} {N};
    \edge {N} {E};
    \edge {H} {E};
\end{tikzpicture}

\newcommand{\itemlayer}{$I_1$/A, $I_2$/B}
\newcommand{\hiddenquerylayers}{$H_1$/C/$Q_1$/J, $H_2$/D/$Q_2$/K, $H_3$/E/$Q_3$/L, $H_4$/F/$Q_4$/M, $H_5$/G/$Q_5$/N, $H_6$/H/$Q_6$/O, $H_7$/I/$Q_7$/P}

\begin{figure}[h]
    \begin{tikzpicture}
        \pgfmathsetmacro\diametersqr{1}
        \pgfmathsetmacro\rectwidth{2}
        \pgfmathsetmacro\rectheight{8}
        \pgfmathsetmacro\spacing{1}
        
        \pgfmathsetmacro\numnodesitem{2}
        \pgfmathsetmacro\numnodeshiddenquery{7}
        
        % item layer
        \xdef\xlist{4}
        \xdef\ylist{4}
        \pgfmathsetmacro\yoffset{\rectheight / \numnodesitem}
        \foreach \m/\n [count=\l] in \itemlayer{
            \foreach \k in {1,...,400}{ % try 400 times to place without a collision
                \pgfmathsetmacro\x{rnd*\rectwidth}
                \pgfmathsetmacro\y{(\l - 1)*\yoffset + rnd*\yoffset}
                \xdef\collision{0}
                \foreach \element [count=\i] in \xlist{
                    \pgfmathtruncatemacro\j{\i-1}
                    \pgfmathsetmacro\checkdistancesqr{ ( ({\xlist}[\j]-(\x))^2 + ({\ylist}[\j]-(\y))^2 ) }
                    \ifdim\checkdistancesqr pt<\diametersqr pt
                        \xdef\collision{1}
                        \breakforeach
                    \fi
                }
                \ifnum\collision=0
                    \xdef\xlist{\xlist,\x}
                    \xdef\ylist{\ylist,\y}
                    \draw (\x,\y) node[item on] (\n) {\m};
                    \breakforeach
                \fi 
            }
        }
        
        % hidden layer
        \xdef\xlist{4}
        \xdef\ylist{4}
        \pgfmathsetmacro\yoffset{\rectheight / \numnodeshiddenquery}
        \foreach \m/\n/\o/\p [count=\l] in \hiddenquerylayers{
            \foreach \k in {1,...,400}{ % try 400 times to place without a collision
                \pgfmathsetmacro\x{((-1)^\l)*rnd*\rectwidth + 2*\rectwidth + \spacing}
                \pgfmathsetmacro\y{(\l - 1)*\yoffset + rnd*\yoffset}
                \xdef\collision{0}
                \foreach \element [count=\i] in \xlist{
                    \pgfmathtruncatemacro\j{\i-1}
                    \pgfmathsetmacro\checkdistancesqr{ ( ({\xlist}[\j]-(\x))^2 + ({\ylist}[\j]-(\y))^2 ) }
                    \ifdim\checkdistancesqr pt<\diametersqr pt
                        \xdef\collision{1}
                        \breakforeach
                    \fi
                }
                \ifnum\collision=0
                    \xdef\xlist{\xlist,\x}
                    \xdef\ylist{\ylist,\y}
                    \draw (\x,\y) node[hidden on] (\n) {\m};
                
                    \pgfmathsetmacro\x{\x + 2*\rectwidth + \spacing}
                    \draw (\x,\y) node[query on] (\p) {\o};
                    
                    \breakforeach
                \fi 
            }
        }
        
        % edges from item to hidden layer
        \edge {A} {C,F};
        \edge {B} {H};
        
        % edges from hidden to query layer
        \edge {C} {J};
        \edge {D} {K};
        \edge {E} {L};
        \edge {F} {M};
        \edge {G} {N};
        \edge {H} {O};
        \edge {I} {P};
        
        % edges within hidden layer
        \edge {C} {E};
        \edge {D} {E};
        \edge {E} {F};
        \edge {F} {G};
        \edge {G} {I};
        \edge {H} {I};
        
        % edges within query layer
        \edge {L} {J};
        \edge {L} {K};
        \edge {M} {L};
        \edge {N} {M};
        \edge {P} {N};
        \edge {P} {O};
        
        % surrounding boxes
        \node (X) [draw=blue, fit= (A) (B), inner sep=0.2cm, ultra thick, fill=blue!20, fill opacity=0.2] {};
        \node [yshift=2.0ex] at (X.north) {\textbf{item layer}};
        
        \node (Y) [draw=orange, fit= (C) (D) (E) (F) (G) (H) (I), inner sep=0.2cm, ultra thick, fill=orange!20, fill opacity=0.2] {};
        \node [yshift=2.0ex] at (Y.north) {\textbf{hidden layer}};
        
        \node (Z) [draw=purple, fit= (J) (K) (L) (M) (N) (O) (P), inner sep=0.2cm, ultra thick, fill=purple!20, fill opacity=0.2] {};
        \node [yshift=2.0ex] at (Z.north) {\textbf{query layer}};
    \end{tikzpicture}
    \caption{BOQA network structure.\footnotemark}
\end{figure}
\footnotetext{Reproduced from \bibentry{bauer2012bayesian}.}










